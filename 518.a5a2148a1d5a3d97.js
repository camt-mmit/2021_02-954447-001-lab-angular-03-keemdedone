"use strict";(self.webpackChunkmy_ng3=self.webpackChunkmy_ng3||[]).push([[518],{4518:(oe,y,c)=>{c.r(y),c.d(y,{GoogleModule:()=>te});var p=c(9808),u=c(8093),n=c(7587),x=c(1135),C=c(4671),G=c(4482),w=c(5403);function P(e,r){return e===r}var L=c(2076),f=c(4004),_=c(7579),I=c(6063);class R extends _.x{constructor(r=1/0,t=1/0,o=I.l){super(),this._bufferSize=r,this._windowTime=t,this._timestampProvider=o,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,r),this._windowTime=Math.max(1,t)}next(r){const{isStopped:t,_buffer:o,_infiniteTimeWindow:i,_timestampProvider:s,_windowTime:a}=this;t||(o.push(r),!i&&o.push(s.now()+a)),this._trimBuffer(),super.next(r)}_subscribe(r){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(r),{_infiniteTimeWindow:o,_buffer:i}=this,s=i.slice();for(let a=0;a<s.length&&!r.closed;a+=o?1:2)r.next(s[a]);return this._checkFinalizedStatuses(r),t}_trimBuffer(){const{_bufferSize:r,_timestampProvider:t,_buffer:o,_infiniteTimeWindow:i}=this,s=(i?1:2)*r;if(r<1/0&&s<o.length&&o.splice(0,o.length-s),!i){const a=t.now();let l=0;for(let h=1;h<o.length&&o[h]<=a;h+=2)l=h;l&&o.splice(0,l+1)}}}var M=c(3099),g=c(9646),k=c(262),T=c(3900),E=c(2923);function S(e,r,t,o,i,s,a){try{var l=e[s](a),h=l.value}catch(ne){return void t(ne)}l.done?r(h):Promise.resolve(h).then(o,i)}function z(e){return function(){var r=this,t=arguments;return new Promise(function(o,i){var s=e.apply(r,t);function a(h){S(s,o,i,a,l,"next",h)}function l(h){S(s,o,i,a,l,"throw",h)}a(void 0)})}}function d(){return(d=z(function*(e){const t=(new TextEncoder).encode(e);return crypto.subtle.digest("SHA-256",t)})).apply(this,arguments)}var A=c(520);const m="google-token",Z="https://oauth2.googleapis.com/token";let v=(()=>{class e{constructor(t,o,i){this.configuration=t,this.http=o,this.router=i,this.tokenReadySubject=new x.X(null),this.tokenData=null,this.tokenReady$=this.tokenReadySubject.asObservable().pipe(function U(e,r=C.y){return e=null!=e?e:P,(0,G.e)((t,o)=>{let i,s=!0;t.subscribe(new w.Q(o,a=>{const l=r(a);(s||!e(i,l))&&(s=!1,i=l,o.next(a))}))})}());const s=localStorage.getItem(m);s&&(this.tokenData=JSON.parse(s)),this.codeVerifier=function j(e){const r=new Uint32Array(e/2);return crypto.getRandomValues(r),Array.from(r,t=>("0"+t.toString(16)).slice(-2)).join("")}(56),this.codeChallenge$=(0,L.D)(function D(e){return d.apply(this,arguments)}(this.codeVerifier)).pipe((0,f.U)(a=>function F(e){return function b(e){let r="",t=new Uint8Array(e),o=t.byteLength;for(var i=0;i<o;i++)r+=String.fromCharCode(t[i]);return btoa(r)}(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(a)),function $(e,r,t){var o,i;let s,a=!1;return e&&"object"==typeof e?(s=null!==(o=e.bufferSize)&&void 0!==o?o:1/0,r=null!==(i=e.windowTime)&&void 0!==i?i:1/0,a=!!e.refCount,t=e.scheduler):s=null!=e?e:1/0,(0,M.B)({connector:()=>new R(s,r,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}(1)),this.getAccessToken().subscribe(()=>this.emmitTokenReadyEvent())}emmitTokenReadyEvent(){this.tokenReadySubject.next(!!this.tokenData)}setTokenData(t){var o;return null===t?localStorage.removeItem(m):(!t.refresh_token&&(null===(o=this.tokenData)||void 0===o?void 0:o.refresh_token)&&(t.refresh_token=this.tokenData.refresh_token),t.expires||(t.expires=(new Date).getTime()+1e3*(t.expires_in-10)),localStorage.setItem(m,JSON.stringify(t))),this.tokenData=t,this.emmitTokenReadyEvent(),(0,g.of)(this.tokenData)}refresh(){var t;return(null===(t=this.tokenData)||void 0===t?void 0:t.refresh_token)?this.http.post(Z,{client_id:this.configuration.client_id,client_secret:this.configuration.client_secret,grant_type:"refresh_token",refresh_token:this.tokenData.refresh_token}).pipe((0,k.K)(o=>(console.error(o),(0,g.of)(null))),(0,T.w)(o=>this.setTokenData(o))):(0,g.of)(null)}getAuthorizationLink(){return this.codeChallenge$.pipe((0,f.U)(t=>{const o=new URL("https://accounts.google.com/o/oauth2/v2/auth");o.searchParams.append("client_id",this.configuration.client_id),o.searchParams.append("redirect_uri",this.configuration.redirect_uri),o.searchParams.append("response_type","code");const i=this.configuration.scopes.join(" ");o.searchParams.append("scope",i),o.searchParams.append("code_challenge",""),o.searchParams.append("code_challenge_method","S256");const s=new URLSearchParams;return s.append("internal_redirect_uri",this.router.url),o.searchParams.append("state",s.toString()),o.searchParams.append("prompt","consent"),o.searchParams.append("access_type","offline"),o.toString()}))}requestAccessToken(t){return this.http.post(Z,{client_id:this.configuration.client_id,client_secret:this.configuration.client_secret,code:t,code_verifier:localStorage.getItem("google-code-verifier"),grant_type:"authorization_code",redirect_uri:this.configuration.redirect_uri}).pipe((0,k.K)(o=>(console.error(o),(0,g.of)(null))),(0,f.U)(o=>this.setTokenData(o)),(0,f.U)(o=>!!o))}getAccessToken(){if(this.tokenData){const t=(new Date).getTime();return this.tokenData.expires<t?this.refresh().pipe((0,f.U)(o=>o?o.access_token:null)):(0,g.of)(this.tokenData.access_token)}return(0,g.of)(null)}getAuthorizationHeader(){return this.getAccessToken().pipe((0,f.U)(t=>{var o;return t?`${null===(o=this.tokenData)||void 0===o?void 0:o.token_type} ${t}`:null}))}}return e.\u0275fac=function(t){return new(t||e)(n.LFG(E.x),n.LFG(A.eN),n.LFG(u.F0))},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),B=(()=>{class e{constructor(t,o,i){this.tokenService=t,this.route=o,this.router=i,this.errorMsg=null}ngOnInit(){const t=this.route.snapshot.queryParams;t.error?this.errorMsg=t.error:t.code&&this.tokenService.requestAccessToken(t.code).subscribe(o=>{if(o){const i=new URLSearchParams(t.state);this.router.navigateByUrl(i.get("internal_redirect_uri"))}else this.errorMsg="Unknow Error!!!"})}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(v),n.Y36(u.gz),n.Y36(u.F0))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-google-authorization-page"]],decls:2,vars:0,template:function(t,o){1&t&&(n.TgZ(0,"p"),n._uU(1,"google-authorization-page works!"),n.qZA())},styles:[""]}),e})(),Q=(()=>{class e{constructor(t,o){this.tokenService=t,this.http=o}getAll(){return this.tokenService.getAuthorizationHeader().pipe((0,T.w)(t=>t?this.http.get("https://www.googleapis.com/calendar/v3/calendars/primary/events",{headers:{Authorization:t}}):(0,g.of)(null)))}}return e.\u0275fac=function(t){return new(t||e)(n.LFG(v),n.LFG(A.eN))},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function K(e,r){if(1&e&&(n.TgZ(0,"div"),n.TgZ(1,"p"),n.TgZ(2,"b"),n._uU(3,"Login by"),n.qZA(),n.TgZ(4,"code"),n._uU(5),n.qZA(),n.qZA(),n.qZA()),2&e){const t=r.ngIf;n.xp6(5),n.hij(" ",t.summary," ")}}function W(e,r){1&e&&(n.O4$(),n.TgZ(0,"svg",2),n._UZ(1,"circle",3),n.qZA())}let X=(()=>{class e{constructor(t){this.service=t}ngOnInit(){this.data$=this.service.getAll()}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(Q))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-google-evevts-list-page"]],decls:4,vars:4,consts:[[4,"ngIf","ngIfElse"],["loading",""],["viewBox","0 0 50 50",1,"spinner"],["cx","25","cy","25","r","20","fill","none","stroke-width","7.5",1,"path"]],template:function(t,o){if(1&t&&(n.YNc(0,K,6,1,"div",0),n.ALo(1,"async"),n.YNc(2,W,2,0,"ng-template",null,1,n.W1O)),2&t){const i=n.MAs(3);n.Q6J("ngIf",n.lcZ(1,2,o.data$))("ngIfElse",i)}},directives:[p.O5],pipes:[p.Ov],styles:[".spinner[_ngcontent-%COMP%]{animation:rotate 2s linear infinite;z-index:2;position:absolute;top:35%;left:50%;margin:-25px 0 0 -25px;width:50px;height:50px}.spinner[_ngcontent-%COMP%] > .path[_ngcontent-%COMP%]{stroke:#00f;stroke-linecap:round;animation:dash 1.5s ease-in-out infinite}@keyframes rotate{to{transform:rotate(360deg)}}@keyframes dash{0%{stroke-dasharray:1,150;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-35}to{stroke-dasharray:90,150;stroke-dashoffset:-124}}"]}),e})();function H(e,r){if(1&e&&(n.TgZ(0,"div"),n.TgZ(1,"a",10),n.ALo(2,"async"),n._uU(3,"Login Google"),n.qZA(),n.qZA()),2&e){const t=n.oxw();n.xp6(1),n.Q6J("href",n.lcZ(2,1,t.authorizationLinks$),n.LSH)}}function q(e,r){1&e&&n._UZ(0,"router-outlet")}const V=[{path:"authorization",component:B},{path:"",component:(()=>{class e{constructor(t){this.TokenService=t}ngOnInit(){this.tokenReady$=this.TokenService.tokenReady$,this.authorizationLinks$=this.TokenService.getAuthorizationLink()}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(v))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-google"]],decls:19,vars:5,consts:[["lang","en"],["charset","UTF-8"],["http-equiv","X-UA-Compatible","content","IE=edge"],["name","viewport","content","width=device-width, initial-scale=1.0"],["rel","stylesheet","href","https://fonts.googleapis.com/icon?family=Material+Icons"],["rel","stylesheet","type","text/css","href","//use.fontawesome.com/releases/v5.7.2/css/all.css"],[1,"cmp-nav"],["routerLink","./events","routerLinkActive","st-active"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"href"]],template:function(t,o){1&t&&(n.TgZ(0,"html",0),n.TgZ(1,"head"),n._UZ(2,"meta",1),n._UZ(3,"meta",2),n._UZ(4,"meta",3),n._UZ(5,"link",4),n._UZ(6,"link",5),n.qZA(),n.TgZ(7,"body"),n.TgZ(8,"h2"),n._uU(9,"Google"),n.qZA(),n.TgZ(10,"nav",6),n.TgZ(11,"ul"),n.TgZ(12,"li"),n.TgZ(13,"a",7),n._uU(14,"Events"),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.ynx(15,8),n.ALo(16,"async"),n.YNc(17,H,4,3,"div",9),n.YNc(18,q,1,0,"router-outlet",9),n.BQk(),n.qZA(),n.qZA()),2&t&&(n.xp6(15),n.Q6J("ngSwitch",n.lcZ(16,3,o.tokenReady$)),n.xp6(2),n.Q6J("ngSwitchCase",!1),n.xp6(1),n.Q6J("ngSwitchCase",!0))},directives:[u.yS,u.Od,p.RF,p.n9,u.lC],pipes:[p.Ov],styles:[""]}),e})(),children:[{path:"",redirectTo:"events",pathMatch:"full"},{path:"events",component:X}]}];let ee=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[[u.Bz.forChild(V)],u.Bz]}),e})(),te=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[[p.ez,ee]]}),e})()}}]);