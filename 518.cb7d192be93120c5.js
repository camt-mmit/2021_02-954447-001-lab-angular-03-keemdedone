"use strict";(self.webpackChunkmy_ng3=self.webpackChunkmy_ng3||[]).push([[518],{4518:(oe,y,c)=>{c.r(y),c.d(y,{GoogleModule:()=>te});var p=c(9808),h=c(8093),n=c(7587),G=c(1135),C=c(4671),x=c(4482),w=c(5403);function L(e,i){return e===i}var P=c(2076),f=c(4004),I=c(7579),_=c(6063);class R extends I.x{constructor(i=1/0,t=1/0,o=_.l){super(),this._bufferSize=i,this._windowTime=t,this._timestampProvider=o,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,i),this._windowTime=Math.max(1,t)}next(i){const{isStopped:t,_buffer:o,_infiniteTimeWindow:r,_timestampProvider:s,_windowTime:a}=this;t||(o.push(i),!r&&o.push(s.now()+a)),this._trimBuffer(),super.next(i)}_subscribe(i){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(i),{_infiniteTimeWindow:o,_buffer:r}=this,s=r.slice();for(let a=0;a<s.length&&!i.closed;a+=o?1:2)i.next(s[a]);return this._checkFinalizedStatuses(i),t}_trimBuffer(){const{_bufferSize:i,_timestampProvider:t,_buffer:o,_infiniteTimeWindow:r}=this,s=(r?1:2)*i;if(i<1/0&&s<o.length&&o.splice(0,o.length-s),!r){const a=t.now();let l=0;for(let u=1;u<o.length&&o[u]<=a;u+=2)l=u;l&&o.splice(0,l+1)}}}var E=c(3099),g=c(9646),T=c(262),S=c(3900),z=c(2923);function k(e,i,t,o,r,s,a){try{var l=e[s](a),u=l.value}catch(ne){return void t(ne)}l.done?i(u):Promise.resolve(u).then(o,r)}function F(e){return function(){var i=this,t=arguments;return new Promise(function(o,r){var s=e.apply(i,t);function a(u){k(s,o,r,a,l,"next",u)}function l(u){k(s,o,r,a,l,"throw",u)}a(void 0)})}}function d(){return(d=F(function*(e){const t=(new TextEncoder).encode(e);return crypto.subtle.digest("SHA-256",t)})).apply(this,arguments)}var A=c(520);const m="google-token",Z="https://oauth2.googleapis.com/token";let v=(()=>{class e{constructor(t,o,r){this.configuration=t,this.http=o,this.router=r,this.tokenReadySubject=new G.X(null),this.tokenData=null,this.tokenReady$=this.tokenReadySubject.asObservable().pipe(function U(e,i=C.y){return e=null!=e?e:L,(0,x.e)((t,o)=>{let r,s=!0;t.subscribe(new w.Q(o,a=>{const l=i(a);(s||!e(r,l))&&(s=!1,r=l,o.next(a))}))})}());const s=localStorage.getItem(m);s&&(this.tokenData=JSON.parse(s)),this.codeVerifier=function j(e){const i=new Uint32Array(e/2);return crypto.getRandomValues(i),Array.from(i,t=>("0"+t.toString(16)).slice(-2)).join("")}(56),this.codeChallenge$=(0,P.D)(function D(e){return d.apply(this,arguments)}(this.codeVerifier)).pipe((0,f.U)(a=>function b(e){return function M(e){let i="",t=new Uint8Array(e),o=t.byteLength;for(var r=0;r<o;r++)i+=String.fromCharCode(t[r]);return btoa(i)}(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(a)),function $(e,i,t){var o,r;let s,a=!1;return e&&"object"==typeof e?(s=null!==(o=e.bufferSize)&&void 0!==o?o:1/0,i=null!==(r=e.windowTime)&&void 0!==r?r:1/0,a=!!e.refCount,t=e.scheduler):s=null!=e?e:1/0,(0,E.B)({connector:()=>new R(s,i,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}(1)),this.getAccessToken().subscribe(()=>this.emmitTokenReadyEvent())}emmitTokenReadyEvent(){this.tokenReadySubject.next(!!this.tokenData)}setTokenData(t){var o;return null===t?localStorage.removeItem(m):(!t.refresh_token&&(null===(o=this.tokenData)||void 0===o?void 0:o.refresh_token)&&(t.refresh_token=this.tokenData.refresh_token),t.expires||(t.expires=(new Date).getTime()+1e3*(t.expires_in-10)),localStorage.setItem(m,JSON.stringify(t))),this.tokenData=t,this.emmitTokenReadyEvent(),(0,g.of)(this.tokenData)}refresh(){var t;return(null===(t=this.tokenData)||void 0===t?void 0:t.refresh_token)?this.http.post(Z,{client_id:this.configuration.client_id,client_secret:this.configuration.client_secret,grant_type:"refresh_token",refresh_token:this.tokenData.refresh_token}).pipe((0,T.K)(o=>(console.error(o),(0,g.of)(null))),(0,S.w)(o=>this.setTokenData(o))):(0,g.of)(null)}getAuthorizationLink(){return this.codeChallenge$.pipe((0,f.U)(t=>{const o=new URL("https://accounts.google.com/o/oauth2/v2/auth");o.searchParams.append("client_id",this.configuration.client_id),o.searchParams.append("redirect_uri",this.configuration.redirect_uri),o.searchParams.append("response_type","code");const r=this.configuration.scopes.join(" ");o.searchParams.append("scope",r),o.searchParams.append("code_challenge",""),o.searchParams.append("code_challenge_method","S256");const s=new URLSearchParams;return s.append("internal_redirect_uri",this.router.url),o.searchParams.append("state",s.toString()),o.searchParams.append("prompt","consent"),o.searchParams.append("access_type","offline"),o.toString()}))}requestAccessToken(t){return this.http.post(Z,{client_id:this.configuration.client_id,client_secret:this.configuration.client_secret,code:t,code_verifier:localStorage.getItem("google-code-verifier"),grant_type:"authorization_code",redirect_uri:this.configuration.redirect_uri}).pipe((0,T.K)(o=>(console.error(o),(0,g.of)(null))),(0,f.U)(o=>this.setTokenData(o)),(0,f.U)(o=>!!o))}getAccessToken(){if(this.tokenData){const t=(new Date).getTime();return this.tokenData.expires<t?this.refresh().pipe((0,f.U)(o=>o?o.access_token:null)):(0,g.of)(this.tokenData.access_token)}return(0,g.of)(null)}getAuthorizationHeader(){return this.getAccessToken().pipe((0,f.U)(t=>{var o;return t?`${null===(o=this.tokenData)||void 0===o?void 0:o.token_type} ${t}`:null}))}}return e.\u0275fac=function(t){return new(t||e)(n.LFG(z.x),n.LFG(A.eN),n.LFG(h.F0))},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),B=(()=>{class e{constructor(t,o,r){this.tokenService=t,this.route=o,this.router=r,this.errorMsg=null}ngOnInit(){const t=this.route.snapshot.queryParams;t.error?this.errorMsg=t.error:t.code&&this.tokenService.requestAccessToken(t.code).subscribe(o=>{if(o){const r=new URLSearchParams(t.state);this.router.navigateByUrl(r.get("internal_redirect_uri"))}else this.errorMsg="Unknow Error!!!"})}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(v),n.Y36(h.gz),n.Y36(h.F0))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-google-authorization-page"]],decls:2,vars:0,template:function(t,o){1&t&&(n.TgZ(0,"p"),n._uU(1,"google-authorization-page works!"),n.qZA())},styles:[""]}),e})(),Q=(()=>{class e{constructor(t,o){this.tokenService=t,this.http=o}getAll(){return this.tokenService.getAuthorizationHeader().pipe((0,S.w)(t=>t?this.http.get("https://www.googleapis.com/calendar/v3/calendars/primary/events",{headers:{Authorization:t}}):(0,g.of)(null)))}}return e.\u0275fac=function(t){return new(t||e)(n.LFG(v),n.LFG(A.eN))},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function K(e,i){if(1&e&&(n.TgZ(0,"div"),n.TgZ(1,"p"),n.TgZ(2,"b"),n._uU(3,"Login by"),n.qZA(),n.TgZ(4,"code"),n._uU(5),n.qZA(),n.qZA(),n.qZA()),2&e){const t=i.ngIf;n.xp6(5),n.hij(" ",t.summary," ")}}function W(e,i){1&e&&(n._UZ(0,"div",2),n.TgZ(1,"p",3),n._uU(2,"Loading..."),n.qZA())}let X=(()=>{class e{constructor(t){this.service=t}ngOnInit(){this.data$=this.service.getAll()}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(Q))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-google-evevts-list-page"]],decls:4,vars:4,consts:[[4,"ngIf","ngIfElse"],["loading",""],[1,"loading-animation"],[1,"loading-txt"]],template:function(t,o){if(1&t&&(n.YNc(0,K,6,1,"div",0),n.ALo(1,"async"),n.YNc(2,W,3,0,"ng-template",null,1,n.W1O)),2&t){const r=n.MAs(3);n.Q6J("ngIf",n.lcZ(1,2,o.data$))("ngIfElse",r)}},directives:[p.O5],pipes:[p.Ov],styles:[""]}),e})();function H(e,i){if(1&e&&(n.TgZ(0,"div"),n.TgZ(1,"a",10),n.ALo(2,"async"),n._uU(3,"Login Google"),n.qZA(),n.qZA()),2&e){const t=n.oxw();n.xp6(1),n.Q6J("href",n.lcZ(2,1,t.authorizationLinks$),n.LSH)}}function q(e,i){1&e&&n._UZ(0,"router-outlet")}const V=[{path:"authorization",component:B},{path:"",component:(()=>{class e{constructor(t){this.TokenService=t}ngOnInit(){this.tokenReady$=this.TokenService.tokenReady$,this.authorizationLinks$=this.TokenService.getAuthorizationLink()}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(v))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-google"]],decls:19,vars:5,consts:[["lang","en"],["charset","UTF-8"],["http-equiv","X-UA-Compatible","content","IE=edge"],["name","viewport","content","width=device-width, initial-scale=1.0"],["rel","stylesheet","href","https://fonts.googleapis.com/icon?family=Material+Icons"],["rel","stylesheet","type","text/css","href","//use.fontawesome.com/releases/v5.7.2/css/all.css"],[1,"cmp-nav"],["routerLink","./events","routerLinkActive","st-active"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"href"]],template:function(t,o){1&t&&(n.TgZ(0,"html",0),n.TgZ(1,"head"),n._UZ(2,"meta",1),n._UZ(3,"meta",2),n._UZ(4,"meta",3),n._UZ(5,"link",4),n._UZ(6,"link",5),n.qZA(),n.TgZ(7,"body"),n.TgZ(8,"h2"),n._uU(9,"Google"),n.qZA(),n.TgZ(10,"nav",6),n.TgZ(11,"ul"),n.TgZ(12,"li"),n.TgZ(13,"a",7),n._uU(14,"Events"),n.qZA(),n.qZA(),n.qZA(),n.qZA(),n.ynx(15,8),n.ALo(16,"async"),n.YNc(17,H,4,3,"div",9),n.YNc(18,q,1,0,"router-outlet",9),n.BQk(),n.qZA(),n.qZA()),2&t&&(n.xp6(15),n.Q6J("ngSwitch",n.lcZ(16,3,o.tokenReady$)),n.xp6(2),n.Q6J("ngSwitchCase",!1),n.xp6(1),n.Q6J("ngSwitchCase",!0))},directives:[h.yS,h.Od,p.RF,p.n9,h.lC],pipes:[p.Ov],styles:[""]}),e})(),children:[{path:"",redirectTo:"events",pathMatch:"full"},{path:"events",component:X}]}];let ee=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[[h.Bz.forChild(V)],h.Bz]}),e})(),te=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[[p.ez,ee]]}),e})()}}]);